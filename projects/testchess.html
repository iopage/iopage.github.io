<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short ID Chess</title>
<link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
.board-container { max-width: 500px; width: 100%; margin: 0 auto; }
#messages::-webkit-scrollbar { width: 4px; }
#messages::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
.collapsible-content { transition: max-height 0.3s ease-out; overflow: hidden; }
.collapsed { max-height: 0 !important; padding: 0 !important; margin: 0 !important; border: 0 !important; }
</style>
</head>
<body class="bg-zinc-900 text-zinc-100 min-h-screen p-4 font-sans">
<div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
<div class="lg:col-span-4 space-y-4">
<!-- Connection Section -->
<div class="bg-zinc-800 p-5 rounded-2xl border border-zinc-700 shadow-xl">
<div class="flex justify-between items-center mb-4 cursor-pointer" onclick="toggleSection('conn-body', 'conn-icon')">
<h1 class="text-xl font-bold text-indigo-400">Connection</h1>
<span id="conn-icon" class="text-indigo-400 font-mono text-xl">^</span>
</div>
<div id="conn-body" class="collapsible-content space-y-4 max-h-[500px]">
<div>
<label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1">Your ID (Give this to peer)</label>
<div class="flex gap-2">
<input id="my-id" class="flex-1 bg-zinc-950 border border-zinc-700 p-2 rounded text-zinc-300 text-xs font-mono" readonly placeholder="Generating...">
<button id="btn-copy-id" class="bg-zinc-700 px-3 rounded text-[10px] font-bold">COPY</button>
</div>
</div>
<div>
<label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1">Connect to Peer ID</label>
<div class="flex gap-2">
<input id="peer-id-input" class="flex-1 bg-zinc-950 border border-zinc-700 p-2 rounded text-zinc-300 text-xs font-mono" placeholder="Paste ID here...">
<button id="btn-connect" class="bg-indigo-600 px-4 rounded text-xs font-bold">JOIN</button>
</div>
</div>
<div class="pt-4 border-t border-zinc-700 flex justify-between items-center">
<span class="text-[10px] text-zinc-500 font-bold uppercase">Status</span>
<span id="conn-status" class="text-xs font-medium text-zinc-400 italic">Initializing...</span>
</div>
</div>
</div>
<!-- Message Section -->
<div class="bg-zinc-800 p-4 rounded-2xl border border-zinc-700">
<div class="flex justify-between items-center mb-3 cursor-pointer" onclick="toggleSection('msg-body', 'msg-icon')">
<h2 class="text-sm font-bold text-zinc-400 uppercase tracking-widest">Messages</h2>
<span id="msg-icon" class="text-zinc-400 font-mono text-xl">^</span>
</div>
<div id="msg-body" class="collapsible-content max-h-[500px]">
<div id="messages" class="h-32 overflow-y-auto text-sm space-y-1 mb-3 pr-2"></div>
<div class="flex gap-2">
<input type="text" id="chat-input" placeholder="Message..." class="flex-1 bg-zinc-950 border border-zinc-700 rounded px-3 py-1 text-sm outline-none">
<button id="btn-send" class="bg-indigo-600 px-3 py-1 rounded text-xs font-bold">Send</button>
</div>
</div>
</div>
</div>
<!-- Chess Board Section -->
<div class="lg:col-span-8 flex flex-col items-center">
<div class="bg-zinc-800 p-5 rounded-3xl border border-zinc-700 shadow-2xl w-full max-w-[550px]">
<div class="flex justify-between items-center mb-4">
<div id="turn-indicator" class="px-3 py-1 rounded-full bg-zinc-950 text-[10px] font-bold border border-zinc-700">Wait...</div>
<button id="btn-reset" class="text-[10px] text-zinc-500 hover:text-red-400 font-bold uppercase">Reset</button>
</div>
<div class="board-container"><div id="myBoard" class="rounded overflow-hidden border-2 border-zinc-950"></div></div>
<p id="game-status" class="text-center mt-4 text-sm font-medium text-zinc-400 italic">Share your ID to start</p>
</div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script>
let board=null, game=new Chess(), peer=null, conn=null, playerRole=null;
function toggleSection(b,i){const el=document.getElementById(b);el.classList.toggle('collapsed');document.getElementById(i).innerText=el.classList.contains('collapsed')?'v':'^'}
function addLog(m,c='zinc-500'){const el=$('#messages');el.append(`<div class="text-${c}">${m}</div>`);el.scrollTop(el[0].scrollHeight)}
function updateUI(){
  const t=game.turn()==='w'?'White':'Black';
  $('#turn-indicator').text(`${t}'s Turn`).css('color',game.turn()==='w'?'#818cf8':'#34d399');
  let s=game.in_checkmate()?`Mate! ${t} loses` : game.in_draw()?"Draw" : game.in_check()?`${t} Check!` : "Active";
  $('#game-status').text(s);
}
// Initialize PeerJS (Uses PeerJS Cloud for signaling, no database needed by you)
peer = new Peer(Math.random().toString(36).substr(2, 6).toUpperCase());
peer.on('open', id => { $('#my-id').val(id); $('#conn-status').text('Ready'); addLog("Your ID is ready."); });
peer.on('connection', c => {
  if (conn) return; // Only allow one opponent
  conn = c; playerRole = 'w'; board.orientation('white'); setupConn();
  addLog("Opponent joined! You are White.", "emerald-400");
});
function setupConn() {
  conn.on('open', () => { $('#conn-status').text('Connected').css('color','#34d399'); updateUI(); });
  conn.on('data', d => {
    if(d.type==='move'){ game.move(d.move); board.position(game.fen()); updateUI(); }
    else if(d.type==='chat'){ addLog(`Opp: ${d.text}`,'indigo-300'); }
    else if(d.type==='reset'){ game.reset(); board.start(); updateUI(); addLog("Reset by opponent"); }
  });
  conn.on('close', () => { $('#conn-status').text('Disconnected'); addLog("Peer left."); conn = null; });
}
$('#btn-connect').click(() => {
  const id = $('#peer-id-input').val().toUpperCase();
  if(!id || conn) return;
  conn = peer.connect(id); playerRole = 'b'; board.orientation('black'); setupConn();
  addLog("Connecting to host...", "indigo-400");
});
$('#btn-copy-id').click(() => { const el=document.getElementById('my-id'); el.select(); document.execCommand('copy'); addLog("ID Copied!"); });
function onDragStart(s,p){
  if(game.game_over() || !conn || game.turn() !== playerRole) return false;
  if((playerRole==='w' && p.search(/^b/)!==-1) || (playerRole==='b' && p.search(/^w/)!==-1)) return false;
}
function onDrop(s,t){
  const m=game.move({from:s,to:t,promotion:'q'}); if(!m) return 'snapback';
  updateUI(); if(conn) conn.send({type:'move', move:m});
}
board=Chessboard('myBoard',{draggable:true, position:'start', onDragStart, onDrop, onSnapEnd:()=>board.position(game.fen()), pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'});
$('#btn-send').click(()=>{
  const t=$('#chat-input').val(); if(t && conn){ conn.send({type:'chat', text:t}); addLog(`Me: ${t}`,'emerald-400'); $('#chat-input').val(''); }
});
$('#btn-reset').click(()=>{ if(confirm("Reset?")){ game.reset(); board.start(); updateUI(); if(conn) conn.send({type:'reset'}); }});
updateUI();
</script>
</body>
</html>